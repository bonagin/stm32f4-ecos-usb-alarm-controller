/*
 * session_read_data.cc
 *
 *  Created on: 14 Jul 2015
 *      Author: root
 */
#include <crc.h>
#include <session.h>

#include "sess_read_data.h"

cSessReadData::cSessReadData(duplexInterface * interface) : cSession(interface)
{
}

bool cSessReadData::execute()
{
	bool status = false;

    diag_printf("Executing the cSessReadData session\n");
    cyg_uint8 buff[512];

    buff[0] = 0xF7;
    cyg_uint32 len = waitReply(buff,1,sizeof(buff));//send the device serial as acknowledgment

    if(len)
    {
    	if(handle_response(buff,len))
    	{
    	    diag_printf("Valid data received len : %d, sending acknowledgment\n",len);
    	    status = true;
    		cyg_uint8 ACK[1] = {0xF7};
            mIf->transmit(ACK,sizeof(ACK));
    	}
    }

	return status;
}

bool cSessReadData::handle_response(cyg_uint8 * buff, cyg_uint32 buff_len)
{

}

cSessReadData::~cSessReadData()
{

}


